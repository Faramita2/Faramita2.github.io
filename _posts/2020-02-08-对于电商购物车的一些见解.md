---
layout: post
title: "对于电商购物车的一些见解"
---

# 对于电商购物车的一些见解

最近有做了两个电商的项目，第一个商城比较简单，是已登录用户保存到数据库的形式实现的，意味着所有购物车数据有和任意登录用户绑定，不存在临时购物车；第二个由于前人写的代码中，包含了临时购物车的数据库设计，因而顺水推舟，我加上了临时购物车的实现。

下面说说整个购物车实现由简单到复杂的过程，以及一些自己实现过程的心路历程。

## 购物车数据的形式

在实现购物车数据的存储之前，要先要弄明白，购物车这样一个数据载体，存储的数据形式是怎样的。

拿最简单最必要的数据说起，那必须有商品ID`goods_id`，商品数量`goods_num`，考虑到商品存在多规格的可能，于是还得增加商品规格ID`item_id`，为了查询索引和操作方便，每一条购物车数据要有一个唯一的键ID`id`。

所以一条购物车数据`cart`的形式至少为：
```javascript
{
    "id": "购物车唯一ID",
    "goods_id": "商品ID",
    "item_id": "商品规格ID",
    "goods_num": "购物车商品数量"
}
```

当然，上述是我的理解，在我同事的数据表设计中，还存在了一些“冗余”的字段：是商品和商品规格的一些信息。对此，我曾思考过，是否需要保存这些信息在购物车数据体中。

结果是我并不认为需要保存在其中。试想加载购物车的时候，获取的商品信息一定都要是最新的，不然用户会得到错误的信息。那么对比本次购物车的商品信息和上次的商品信息，无外乎两种可能性：  
  1. 本次商品信息和上次一样
  2. 本次商品信息和上次不一样  

要是第一种情况，那么数据库保存的商品信息是可以使用的，由于和购物车本身的信息包含在一块，意味着可以直接使用，不需要额外的查询商品信息。但是这里问题是，如何知道此时的商品信息和上次的商品信息没有差异呢？还是需要去数据库查询吧！  
若是第二种情况，那好说了，就直接查询商品的信息，然后拼装到购物车中。
  
于是，综合看来，无论如何都要查询，那为何还需要保存冗余的商品信息呢？在我看来，有一种场景是需要之前的商品信息的，那就是购物车保存的商品元数据(`goods_id`,`item_id`)查询的结果不存在或者不可用。此时数据库返回的数据不能使用或者为空，这条数据不能删除。因此此条购物车数据显示的还是上次的商品信息，但是会给到前端一个特定的类似于不可用的标识（如下图）。 

![Disabled cart](/assets/disabled-cart.jpg)

这样的设计，在用户体验上应该是好很多的，不会存在用户添加到购物车的商品，在后台商品信息的变动或其他原因导致突然没有了信息。因此，在购物车中数据体加上商品的信息还是有一定的必要性，因此，最终购物车的数据体为：
```javascript
{
    "id": "购物车唯一ID",
    "goods_id": "商品ID",
    "item_id": "商品规格ID",
    "goods_num": "购物车商品数量"，
    "goods_name": "商品名称",
    "goods_image": "商品图片",
    "goods_price": "商品单价",
    ... // 酌情增加需要的商品信息
}
```

## 不同用户状态下购物车数据的保存

### 


